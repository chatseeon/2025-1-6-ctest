<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C语言程序设计练习试卷4</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #2980b9;
            border-left: 4px solid #3498db;
            padding-left: 10px;
            margin-top: 30px;
        }
        .question {
            background-color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .options {
            margin: 10px 0;
        }
        .option {
            margin: 5px 0;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        .option:hover {
            background-color: #f0f0f0;
        }
        .option.selected {
            background-color: #d4edff;
        }
        .option.correct {
            background-color: #d4edda;
            color: #155724;
        }
        .option.wrong {
            background-color: #f8d7da;
            color: #721c24;
        }
        .explanation {
            display: none;
            padding: 10px;
            margin-top: 10px;
            background-color: #e9ecef;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .explanation.show {
            display: block;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .score-display {
            text-align: center;
            font-size: 1.2em;
            margin: 20px 0;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 5px;
        }
        .code {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        .error-line {
            background-color: #fff3cd;
        }
        .blank-line {
            background-color: #d1ecf1;
        }
    </style>
</head>
<body>
    <h1>C语言程序设计练习试卷4</h1>
    
    <div class="score-display">
        得分: <span id="score">0</span> / <span id="total">100</span>
    </div>

    <h2>一、选择题（每题2分，共50分）</h2>
    
    <div id="questions-container">
        <!-- 选择题将在这里动态生成 -->
    </div>

    <h2>二、改错题（每题15分，共30分）</h2>
    
    <div class="question">
        <p>1. 题目如下图</p>
        <img src="屏幕截图 2025-06-07 124011-1.png" alt="输出图形示例" style="max-height: 200px; margin: 10px 0;">
        <pre class="code">
#include &lt;stdio.h&gt;
void main()
{
  int i,j,m;
  printf("请输入一个整数:");
  scanf("%d",<span class="error-line">m</span>);   /*$ERROR$*/
  for(j=1;j&lt;=2*m+1;j++)
     putchar('*');
  printf('<span class="error-line">\n</span>');    /*$ERROR$*/
  i=1;     
  while(i&lt;=2*m-1)
  {
    for(j=1;j&lt;=m;j++)
      putchar(' ');
    printf("*\n");
    i<span class="error-line">+1</span>;           /*$ERROR$*/
   }
  for(j=1;j&lt;=2*m+1;j++)
     putchar('*');
  putchar('\n');
}</pre>
        <div class="options">
            <p>请指出错误并修改：</p>
            <p>1. 第一处错误：<input type="text" id="correction1" placeholder="请输入修正后的代码"></p>
            <p>2. 第二处错误：<input type="text" id="correction2" placeholder="请输入修正后的代码"></p>
            <p>3. 第三处错误：<input type="text" id="correction3" placeholder="请输入修正后的代码"></p>
        </div>
        <button onclick="checkCorrections()">提交改错题答案</button>
        <div id="correction-feedback" class="explanation"></div>
    </div>

    <div class="question">
        <p>2. 题目如下图</p>
        <img src="屏幕截图 2025-06-07 124119-1.png" alt="函数计算问题" style="max-height: 200px; margin: 10px 0;">
        <pre class="code">
#include &lt;stdio.h&gt;
double fun(double x,int n)
{
    double s;
    int i;
    s=<span class="error-line">0</span>;                /*$ERROR$*/
    for(i=1;i&lt;=n;i++)
        s=s*x;
    return <span class="error-line">x</span>;            /*$ERROR$*/
}
void main()
{
    double a,b,m1,m2,m3,m;
    printf("请输入a和b：\n");
    scanf("%lf%lf",&a,&b);            
    m1=fun(a,4);
    m2=fun(b,4);
    m3=fun(<span class="error-line">3,a+b</span>);            /*$ERROR$*/
    m=m1+m2+m3;    
    printf("m=%f\n",m);    
}</pre>
        <div class="options">
            <p>请指出错误并修改：</p>
            <p>1. 第一处错误：<input type="text" id="correction4" placeholder="请输入修正后的代码"></p>
            <p>2. 第二处错误：<input type="text" id="correction5" placeholder="请输入修正后的代码"></p>
            <p>3. 第三处错误：<input type="text" id="correction6" placeholder="请输入修正后的代码"></p>
        </div>
        <button onclick="checkCorrections2()">提交改错题答案</button>
        <div id="correction-feedback2" class="explanation"></div>
    </div>

    <h2>三、程序填空题（每空5分，共15分）</h2>
    
    <div class="question">
        <p>运行时输入一个整数number，输出该数各位数字之和（如number=1308则输出12，number=-3204则输出9）</p>
        <pre class="code">
/*计算number各各位数字之和*/
#include &lt;stdio.h&gt;
#include &lt;stdio.h&gt;
#include &lt;math.h&gt;
void main()
{
    int number,sum=0;
    printf("Please input an INT number:");
    scanf("%d",<span class="blank-line">______</span>);        /*$BLANK$*/
    number=abs(<span class="blank-line">______</span>);        /*$BLANK$*/
    while(number!=0)           
    {
        sum=sum+number%10;
        number=<span class="blank-line">______</span>;         /*$BLANK$*/ 
    }
    printf("%d\n",sum);
}</pre>
        <div class="options">
            <p>请填写空白处：</p>
            <p>1. 第一处空白：<input type="text" id="blank1" placeholder="请输入填空内容"></p>
            <p>2. 第二处空白：<input type="text" id="blank2" placeholder="请输入填空内容"></p>
            <p>3. 第三处空白：<input type="text" id="blank3" placeholder="请输入填空内容"></p>
        </div>
        <button onclick="checkBlanks()">提交填空题答案</button>
        <div id="blank-feedback" class="explanation"></div>
    </div>

    <h2>四、综合应用题（共30分）</h2>
    
    <div class="question">
        <p>1. （8分）回文数是指其各位数字左右对称的正整数，例如121，右边个位数与左边百位数相同，所以121是回文数。输入一个3位正整数，判断它是不是回文数。</p>
        <p>（要求使用选择结构实现）。</p>
        <p>示例：输入 525，输出 525是3位回文数</p>
        <div class="options">
            <p>请编写完整程序：</p>
            <textarea id="program1" rows="10" style="width:100%; font-family: 'Courier New', Courier, monospace;" placeholder="请在此处编写程序代码"></textarea>
        </div>
        <button onclick="checkProgram1()">提交程序答案</button>
        <div id="program1-feedback" class="explanation"></div>
    </div>

    <div class="question">
        <p>2. （10分）题目如下图</p>
        <img src="屏幕截图 2025-06-07 124206-1.png" alt="数列计算问题" style="max-height: 200px; margin: 10px 0;">
        <div class="options">
            <p>请编写完整程序：</p>
            <textarea id="program2" rows="10" style="width:100%; font-family: 'Courier New', Courier, monospace;" placeholder="请在此处编写程序代码"></textarea>
        </div>
        <button onclick="checkProgram2()">提交程序答案</button>
        <div id="program2-feedback" class="explanation"></div>
    </div>

    <div class="question">
        <p>3. （12分）为响应环保出行，小华坚持骑车上班。9月份上班来回用时（分钟）分别存储在数组a和b中，其中-1表示未上班或未骑车。计算并输出小华骑车单程平均用时（要求使用循环实现，结果保留2位小数）。</p>
        <p>说明：单程表示上班或下班的行程。</p>
        <p>输出格式为：单程平均用时 30.12 分钟</p>
        <pre class="code">
int a[30]={35,-1,34,34,32,32,34,34,31,32,30,31,32,33,-1,33,32,34,31,35,30,34,-1,31,32,30,31,32,33,30};
int b[30]={31,35,32,34,34,-1,32,31,31,36,34,32,31,30,-1,34,31,31,32,32,32,32,-1,31,36,32,33,31,35,31};</pre>
        <div class="options">
            <p>请编写完整程序：</p>
            <textarea id="program3" rows="10" style="width:100%; font-family: 'Courier New', Courier, monospace;" placeholder="请在此处编写程序代码"></textarea>
        </div>
        <button onclick="checkProgram3()">提交程序答案</button>
        <div id="program3-feedback" class="explanation"></div>
    </div>

    <script>
        // 试题数据
        const questions = [
            {
                question: "1. 在一个C程序中______。",
                options: [
                    "A. main函数必须出现在所有函数之前",
                    "B. main函数不一定要求出现在所有函数之后",
                    "C. main函数必须出现在所有函数之后",
                    "D. main函数必须出现在固定位置"
                ],
                correct: 1,
                explanation: "解析：B选项正确，main函数可以出现在任何位置，但程序执行总是从main函数开始。"
            },
            {
                question: "2. 已知int a=0x20;，以下说法正确的是______。",
                options: [
                    "A. a是常量",
                    "B. a=0x20是常量",
                    "C. 0x20是常量",
                    "D. 没有常量"
                ],
                correct: 2,
                explanation: "解析：0x20是十六进制整型常量。a是变量，a=0x20是赋值语句。"
            },
            {
                question: "3. 以下选项中，不合法的C语言标识符的是______。",
                options: [
                    "A. _Myfile2",
                    "B. Myfile_2",
                    "C. 2_Myfile",
                    "D. Myfile2"
                ],
                correct: 2,
                explanation: "解析：C选项以数字开头，不符合标识符命名规则。"
            },
            {
                question: "4. 设有int a=3,c=6;，则执行语句c*=2*(c-a);后c的值是______。",
                options: [
                    "A. 36",
                    "B. 6",
                    "C. 12",
                    "D. 35"
                ],
                correct: 0,
                explanation: "解析：计算过程：c-a=3, 2 * 3=6, c*=6 → c=6 * 6=36。"
            },
            {
                question: "5. 设有int k=0,j;，执行语句j=k++;后，则变量j,k的值是______。",
                options: [
                    "A. 1,0",
                    "B. 1,1",
                    "C. 0,1",
                    "D. 0,0"
                ],
                correct: 2,
                explanation: "解析：k++是先赋值后自增，所以j=0，然后k=1。"
            },
            {
                question: "6. 设变量x,y,z均为int类型，则以下程序段的输出结果是______。<br>x=y=3;<br>z=++x,y++;<br>printf(\"%d\",z);",
                options: [
                    "A. 2",
                    "B. 3",
                    "C. 4",
                    "D. 5"
                ],
                correct: 2,
                explanation: "解析：++x使x=4，z=4；y++在逗号表达式之后执行。"
            },
            {
                question: "7. 以下程序段的输出结果是______。<br>char c1='b',c2='C';<br>printf(\"%d,%c\\n\",c1-32,c2+32);",
                options: [
                    "A. 66,C",
                    "B. 66,c",
                    "C. 98,C",
                    "D. 98,c"
                ],
                correct: 1,
                explanation: "解析：'b'-32=66('B'的ASCII码)，'C'+32=99('c'的ASCII码)。"
            },
            {
                question: "8. 若变量ch为char类型，以下不能正确判断其为小写字母的表达式是______。",
                options: [
                    "A. 'a'<=ch<='z'",
                    "B. ch>='a'&&ch<='z'",
                    "C. (ch-32)>= 'A'&&(ch-32)<= 'Z'",
                    "D. !(ch<'a'||ch>'z')"
                ],
                correct: 0,
                explanation: "解析：A选项语法错误，应拆分为两个条件用&&连接。"
            },
            {
                question: "9. 以下程序段输出结果是______。<br>int x=97;<br>printf(\"%c\",x+1);",
                options: [
                    "A. A",
                    "B. a",
                    "C. B",
                    "D. b"
                ],
                correct: 3,
                explanation: "解析：97是'a'的ASCII码，97+1=98是'b'的ASCII码。"
            },
            {
                question: "10. 分析以下程序段，下列说法正确的是______。<br>int x=5,a=2,b=1;<br>if(x=a+b)<br>printf(\"****\\n\");<br>else<br>printf(\"####\\n\");",
                options: [
                    "A. 有语法错，不能通过编译",
                    "B. 通过编译，但不能连接",
                    "C. 输出****",
                    "D. 输出####"
                ],
                correct: 2,
                explanation: "解析：x=a+b=3(非零)，条件为真，输出****。"
            },
            {
                question: "11. 设有int a=2,b=4,c;，执行语句c=(a>b?b+1:a*3);后c的值为______。",
                options: [
                    "A. 4",
                    "B. 5",
                    "C. 6",
                    "D. 7"
                ],
                correct: 2,
                explanation: "解析：a>b为假，执行a*3=6。"
            },
            {
                question: "12. 设有定义：int i;，则执行语句for(i=3;i<6;i+=2);后，变量i的值是______。",
                options: [
                    "A. 5",
                    "B. 6",
                    "C. 7",
                    "D. 8"
                ],
                correct: 2,
                explanation: "解析：循环过程：i=3→5→7(退出循环)。"
            },
            {
                question: "13. 设有int k=10;，则while(k>0) k=k-1;中循环体语句被执行的次数为______。",
                options: [
                    "A. 0",
                    "B. 1",
                    "C. 10",
                    "D. 11"
                ],
                correct: 2,
                explanation: "解析：k从10递减到1，共执行10次。"
            },
            {
                question: "14. 以下程序段的运行结果是______。<br>int n;<br>for(n=1;n<=10;n++)<br>{<br>if(n%3==0) continue;<br>printf(\"%d\",n);<br>}",
                options: [
                    "A. 12457810",
                    "B. 369",
                    "C. 12",
                    "D. 1234567890"
                ],
                correct: 0,
                explanation: "解析：跳过3的倍数，输出1,2,4,5,7,8,10。"
            },
            {
                question: "15. 设有定义：int a[5]={1},x;，执行语句x=a[0]+a[1];后，x的值是______。",
                options: [
                    "A. 0",
                    "B. 1",
                    "C. 2",
                    "D. 不确定"
                ],
                correct: 1,
                explanation: "解析：a[0]=1，a[1]未初始化默认为0，x=1+0=1。"
            },
            {
                question: "16. 下列程序段的输出结果是_______。<br>int k,a[3][3]={1,2,3,4,5,6,7,8,9};<br>int s=0;<br>for(k=0;k<3;k++)<br>s=s+a[k][0];<br>printf(\"%d\",s);",
                options: [
                    "A. 6",
                    "B. 12",
                    "C. 15",
                    "D. 45"
                ],
                correct: 1,
                explanation: "解析：累加第一列元素：1+4+7=12。"
            },
            {
                question: "17. 以下程序段的输出结果是______。<br>char s[]=\"Hello World!\";<br>strlwr(s);<br>printf(\"%s\",s);",
                options: [
                    "A. hello world!",
                    "B. HELLO world!",
                    "C. hello WORLD!",
                    "D. HELLO WORLD!"
                ],
                correct: 0,
                explanation: "解析：strlwr函数将字符串转换为小写。"
            },
            {
                question: "18. 以下函数的类型是______。<br>fff(float x)<br>{<br>return x*x;<br>}",
                options: [
                    "A. 与参数x的类型相同",
                    "B. void类型",
                    "C. int类型",
                    "D. 无法确定"
                ],
                correct: 2,
                explanation: "解析：未指定返回类型默认返回int类型。"
            },
            {
                question: "19. 下面描述中正确的是______。",
                options: [
                    "A. 全局变量定义在函数体之外",
                    "B. 函数体内也可以定义全局变量",
                    "C. 形参可以是全局变量，也可以是局部变量",
                    "D. 局部变量可以被其它函数使用"
                ],
                correct: 0,
                explanation: "解析：A选项正确，全局变量定义在所有函数之外。"
            },
            {
                question: "20. 执行以下程序后，输出结果是______。<br>#include &lt;stdio.h&gt;<br>int fun(int n)<br>{<br>if(n==1)<br>return 1;<br>else<br>return n*fun(n-1);<br>}<br>void main()<br>{<br>printf(\"%d\\n\",fun(5));<br>}",
                options: [
                    "A. 1",
                    "B. 5",
                    "C. 15",
                    "D. 120"
                ],
                correct: 3,
                explanation: "解析：计算5的阶乘：5!=120。"
            },
            {
                question: "21. 已知：int a=2,b=3,k,*p1=&a,*p2=&b;，以下选项中错误的语句是______。",
                options: [
                    "A. k=*p1+*p2;",
                    "B. k=*p1*(*p2);",
                    "C. p2=k;",
                    "D. p1=p2;"
                ],
                correct: 2,
                explanation: "解析：C选项错误，不能将整数值赋给指针变量。"
            },
            {
                question: "22. 以下程序段的输出结果是______。<br>int a[10]={9,8,7,6,5,4,3,2,1,0},*p=a+2;<br>printf(\"%d\",*--p);",
                options: [
                    "A. 6",
                    "B. a[2]的地址",
                    "C. 8",
                    "D. 7"
                ],
                correct: 2,
                explanation: "解析：p初始指向a[2]=7，--p指向a[1]=8。"
            },
            {
                question: "23. 下列说法不正确的是________。",
                options: [
                    "A. 预处理命令主要有三种：文件包含、宏定义、条件编译",
                    "B. 宏定义有两种：带参数的宏、不带参数的宏",
                    "C. 一个#include可以包含多个头文件",
                    "D. 所有编译预处理命令必须以\"#\"号开头"
                ],
                correct: 2,
                explanation: "解析：C选项不正确，一个#include只能包含一个头文件。"
            },
            {
                question: "24. 以下叙述中不正确的是______。",
                options: [
                    "A. 用typedef可以定义各种类型名，但不能用来定义变量",
                    "B. 用typedef可以增加新类型",
                    "C. 用typedef只是将已存在的类型用一个新的标识符来代表",
                    "D. 使用typedef有利于程序的通用和移植"
                ],
                correct: 1,
                explanation: "解析：B选项不正确，typedef不能创建新类型，只是为已有类型创建别名。"
            },
            {
                question: "25. 以读写方式打开一个已有的二进制文件cct.bin，以下选项中正确的是______。",
                options: [
                    "A. FILE *fp;fp=fopen(\"cct.bin\",\"r\");",
                    "B. FILE *fp;fp=fopen(\"cct.bin\",\"a\");",
                    "C. FILE *fp;fp=fopen(\"cct.bin\",\"rb\");",
                    "D. FILE *fp;fp=fopen(\"cct.bin\",\"rb+\");"
                ],
                correct: 3,
                explanation: "解析：\"rb+\"模式可读写二进制文件。A选项是文本只读；B选项是追加；C选项是二进制只读。"
            }
        ];

        // 改错题和填空题的正确答案
        const correctionAnswers = {
            correction1: "&m",
            correction2: "\"\\n\"",
            correction3: "i++",
            correction4: "1",
            correction5: "s",
            correction6: "a+b,3",
            blank1: "&number",
            blank2: "number",
            blank3: "number/10"
        };

        // 综合应用题参考答案
        const programAnswers = {
            program1: `#include &lt;stdio.h&gt;
void main()
{
    int a,x,y;
    printf("请输入一个3位正整数：");
    scanf("%d",&a);
    if(a>=100&&a<=999)
    {
        x=a/100;
        y=a%10;
        if(x==y)
            printf("%d是3位回文数\\n",a); 
        else
            printf("%d不是3位回文数\\n",a); 
    }
    else
        printf("%d不是3位数\\n",a); 
}`,
            program2: `#include &lt;stdio.h&gt;
void main()
{
    int i,n;
    double s=1;
    scanf("%d",&n);
    for(i=1;i<=n;i++)
    {
        s=s*(2*i)*(2*i)/((2*i-1)*(2*i+1));
    }
    printf("s=%.4f\\n",s);
}`,
            program3: `#include &lt;stdio.h&gt;
void main()
{    
    int a[30]={35,-1,34,34,32,32,34,34,31,32,30,31,32,33,-1,33,32,34,31,35,30,34,-1,31,32,30,31,32,33,30};
    int b[30]={31,35,32,34,34,-1,32,31,31,36,34,32,31,30,-1,34,31,31,32,32,32,32,-1,31,36,32,33,31,35,31};
    int i,n=0;
    double sum=0;
    for(i=0;i<30;i++)
    {
        if(a[i]!=-1)
        {
            sum+=a[i];
            n++;
        }
        if(b[i]!=-1)
        {
            sum+=b[i];
            n++;
        }
    }
    printf("单程平均用时 %.2lf 分钟\\n",sum/n);
}`
        };

        // 初始化试卷
        let score = 0;
        let answeredQuestions = 0;
        const totalScore = 100;
        const questionsContainer = document.getElementById('questions-container');

        // 渲染选择题
        questions.forEach((q, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            questionDiv.innerHTML = `
                <p>${q.question}</p>
                <div class="options">
                    ${q.options.map((opt, i) => `
                        <div class="option" onclick="selectOption(this, ${index}, ${i})">${opt}</div>
                    `).join('')}
                </div>
                <div id="explanation-${index}" class="explanation">${q.explanation}</div>
            `;
            questionsContainer.appendChild(questionDiv);
        });

        // 更新分数显示
        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('total').textContent = totalScore;
        }

        // 选择选项
        window.selectOption = function(element, questionIndex, optionIndex) {
            const question = questions[questionIndex];
            const options = element.parentElement.children;
            
            // 移除之前的选择
            for (let i = 0; i < options.length; i++) {
                options[i].classList.remove('selected', 'correct', 'wrong');
            }
            
            // 标记当前选择
            element.classList.add('selected');
            
            // 检查答案
            if (optionIndex === question.correct) {
                element.classList.add('correct');
                // 只有第一次答对才加分
                if (!question.answered) {
                    score += 2;
                    question.answered = true;
                    answeredQuestions++;
                    updateScore();
                }
            } else {
                element.classList.add('wrong');
                // 标记正确答案
                options[question.correct].classList.add('correct');
            }
            
            // 显示解析
            document.getElementById(`explanation-${questionIndex}`).classList.add('show');
        };

        // 检查改错题答案
        window.checkCorrections = function() {
            // 标准化函数：处理全角/半角符号、多余空格等
            const normalizeCode = (code) => {
                return code
                    .replace(/；/g, ';')  // 中文分号 → 英文分号
                    .replace(/\s+/g, '')  // 移除所有空格
                    .toLowerCase();
            };

            // 正确答案配置（支持多种形式）
            const answers = {
                1: ["&m", "&m;"], 
                2: ["\"\\n\"", "'\\n'"],
                3: ["i++", "i++;"]
            };

            let score = 0;
            const feedback = document.getElementById('correction-feedback');
            let feedbackHtml = "";

            // 检查每个空
            for (let i = 1; i <= 3; i++) {
                const userAnswer = normalizeCode(document.getElementById(`correction${i}`).value);
                const isCorrect = answers[i].some(correct => normalizeCode(correct) === userAnswer);

                if (isCorrect) {
                    score += 5;
                    feedbackHtml += `<p>✅ 第 ${i} 处正确 (+5分)</p>`;
                } else {
                    feedbackHtml += `<p>❌ 第 ${i} 处错误：应为 <code>${answers[i][0]}</code></p>`;
                }
            }

            // 更新分数和反馈
            this.score += score;
            updateScore();
            feedback.innerHTML = `${feedbackHtml}<p>总计得分：${score}/15 分</p>`;
            feedback.classList.add('show');
        };

        // 检查第二道改错题答案
        window.checkCorrections2 = function() {
            // 标准化函数：处理全角/半角符号、多余空格等
            const normalizeCode = (code) => {
                return code
                    .replace(/；/g, ';')  // 中文分号 → 英文分号
                    .replace(/\s+/g, '')  // 移除所有空格
                    .toLowerCase();
            };

            // 正确答案配置（支持多种形式）
            const answers = {
                4: ["1", "s=1"], 
                5: ["s", "return s"],
                6: ["a+b,3", "a+b,3;"]
            };

            let score = 0;
            const feedback = document.getElementById('correction-feedback2');
            let feedbackHtml = "";

            // 检查每个空
            for (let i = 4; i <= 6; i++) {
                const userAnswer = normalizeCode(document.getElementById(`correction${i}`).value);
                const isCorrect = answers[i].some(correct => normalizeCode(correct) === userAnswer);

                if (isCorrect) {
                    score += 5;
                    feedbackHtml += `<p>✅ 第 ${i-3} 处正确 (+5分)</p>`;
                } else {
                    feedbackHtml += `<p>❌ 第 ${i-3} 处错误：应为 <code>${answers[i][0]}</code></p>`;
                }
            }

            // 更新分数和反馈
            this.score += score;
            updateScore();
            feedback.innerHTML = `${feedbackHtml}<p>总计得分：${score}/15 分</p>`;
            feedback.classList.add('show');
        };

        // 检查填空题答案
        window.checkBlanks = function() {
            // 标准化函数：处理全角/半角符号、多余空格等
            const normalizeCode = (code) => {
                return code
                    .replace(/；/g, ';')  // 中文分号 → 英文分号
                    .replace(/\s+/g, '')  // 移除所有空格
                    .toLowerCase();
            };

            // 正确答案配置（支持多种形式）
            const answers = {
                1: ["&number", "&number;"], 
                2: ["number", "number;"],
                3: ["number/10", "number/10;"]
            };

            let score = 0;
            const feedback = document.getElementById('blank-feedback');
            let feedbackHtml = "";

            // 检查每个空
            for (let i = 1; i <= 3; i++) {
                const userAnswer = normalizeCode(document.getElementById(`blank${i}`).value);
                const isCorrect = answers[i].some(correct => normalizeCode(correct) === userAnswer);

                if (isCorrect) {
                    score += 5;
                    feedbackHtml += `<p>✅ 第 ${i} 处正确 (+5分)</p>`;
                } else {
                    feedbackHtml += `<p>❌ 第 ${i} 处错误：应为 <code>${answers[i][0]}</code></p>`;
                }
            }

            // 更新分数和反馈
            this.score += score;
            updateScore();
            feedback.innerHTML = `${feedbackHtml}<p>总计得分：${score}/15 分</p>`;
            feedback.classList.add('show');
        };

        // 应用题增强版代码验证方法
        window.checkProgram1 = function() {
            const userCode = document.getElementById('program1').value.trim();
            const feedback = document.getElementById('program1-feedback');
            
            let score = 0;
            const checks = [
                { 
                    pattern: /#include\s*<\s*stdio\.h\s*>/i, 
                    weight: 1,
                    message: "✅ 包含标准输入输出头文件"
                },
                { 
                    pattern: /scanf\s*\(\s*"%d"\s*,\s*&a\s*\)/i, 
                    weight: 2,
                    message: "✅ 正确获取输入数据"
                },
                {
                    pattern: /if\s*\(\s*a\s*>=\s*100\s*&&\s*a\s*<=\s*999\s*\)/i,
                    weight: 2,
                    message: "✅ 包含3位数的验证"
                },
                {
                    pattern: /x\s*=\s*a\s*\/\s*100\s*;/i,
                    weight: 2,
                    message: "✅ 包含百位数提取"
                },
                {
                    pattern: /y\s*=\s*a\s*%\s*10\s*;/i,
                    weight: 2,
                    message: "✅ 包含个位数提取"
                },
                { 
                    pattern: /if\s*\(\s*x\s*==\s*y\s*\)/i, 
                    weight: 1,
                    message: "✅ 包含回文数判断"
                }
            ];

            let feedbackMsg = "<strong>检查结果：</strong><br>";
            checks.forEach(check => {
                if (check.pattern.test(userCode)) {
                    score += check.weight;
                    feedbackMsg += check.message + `<br>`;
                } else {
                    feedbackMsg += `❌ 缺少：${check.message.replace("✅ ", "")}<br>`;
                }
            });

            const finalScore = Math.min(8, Math.floor(score * 8 / 10));
            this.score += finalScore;
            
            feedbackMsg += finalScore >= 6 ? 
                `<br>💡 得分：${finalScore}/8 (良好)` : 
                `<br>💡 得分：${finalScore}/8 (参考代码：<pre>${programAnswers.program1}</pre>)`;

            updateScore();
            feedback.innerHTML = feedbackMsg;
            feedback.classList.add('show');
        };

        window.checkProgram2 = function() {
            const userCode = document.getElementById('program2').value.trim();
            const feedback = document.getElementById('program2-feedback');
            
            let score = 0;
            const checks = [
                {
                    pattern: /for\s*\(\s*(int\s+)?i\s*=\s*1\s*;\s*i\s*<=\s*n\s*;\s*i\+\+\s*\)/i,
                    weight: 3,
                    message: "✅ 正确实现1-n循环"
                },
                {
                    pattern: /s\s*=\s*s\s*\*\s*\(?\s*2\s*\*\s*i\s*\)?\s*\*\s*\(?\s*2\s*\*\s*i\s*\)?\s*\/\s*\(?\s*\(?\s*2\s*\*\s*i\s*-\s*1\s*\)?\s*\*\s*\(?\s*2\s*\*\s*i\s*\+\s*1\s*\)?\s*\)?/i,
                    weight: 5,
                    message: "✅ 包含正确的数列项计算"
                },
                {
                    pattern: /printf\s*\(\s*".*%\.4f.*"\s*,\s*s\s*\)/i,
                    weight: 2,
                    message: "✅ 正确格式化输出(4位小数)"
                }
            ];


            let feedbackMsg = "<strong>检查结果：</strong><br>";
            checks.forEach(check => {
                if (check.pattern.test(userCode)) {
                    score += check.weight;
                    feedbackMsg += check.message + `<br>`;
                } else {
                    feedbackMsg += `❌ 缺少：${check.message.replace("✅ ", "")}<br>`;
                }
            });

            const finalScore = Math.min(10, Math.floor(score * 10 / 10));
            this.score += finalScore;
            
            feedbackMsg += finalScore >= 7 ? 
                `<br>💡 得分：${finalScore}/10 (良好)` : 
                `<br>💡 得分：${finalScore}/10 (参考代码：<pre>${programAnswers.program2}</pre>)`;

            updateScore();
            feedback.innerHTML = feedbackMsg;
            feedback.classList.add('show');
        };

        window.checkProgram3 = function() {
            const userCode = document.getElementById('program3').value.trim();
            const feedback = document.getElementById('program3-feedback');
            
            let score = 0;
            const checks = [
                {
                    pattern: /for\s*\(\s*(int\s+)?i\s*=\s*0\s*;\s*i\s*<\s*30\s*;\s*i\+\+\s*\)/i,
                    weight: 3,
                    message: "✅ 正确遍历30天数据"
                },
                {
                    pattern: /if\s*\(\s*a\s*\[\s*i\s*\]\s*!=\s*-?1\s*\)/i,
                    weight: 2,
                    message: "✅ 包含上班时间的有效判断"
                },
                {
                    pattern: /if\s*\(\s*b\s*\[\s*i\s*\]\s*!=\s*-?1\s*\)/i,
                    weight: 2,
                    message: "✅ 包含下班时间的有效判断"
                },
                {
                    pattern: /sum\s*\+=\s*a\s*\[\s*i\s*\]\s*;|sum\s*=\s*sum\s*\+\s*a\s*\[\s*i\s*\]\s*;/i,
                    weight: 2,
                    message: "✅ 包含上班时间的累加"
                },
                {
                    pattern: /sum\s*\+=\s*b\s*\[\s*i\s*\]\s*;|sum\s*=\s*sum\s*\+\s*b\s*\[\s*i\s*\]\s*;/i,
                    weight: 2,
                    message: "✅ 包含下班时间的累加"
                },
                {
                    pattern: /printf\s*\(\s*".*%\.2lf.*"\s*,\s*.+\)/i,
                    weight: 1,
                    message: "✅ 正确格式化输出(2位小数)"
                }

            ];


            let feedbackMsg = "<strong>检查结果：</strong><br>";
            checks.forEach(check => {
                if (check.pattern.test(userCode)) {
                    score += check.weight;
                    feedbackMsg += check.message + `<br>`;
                } else {
                    feedbackMsg += `❌ 缺少：${check.message.replace("✅ ", "")}<br>`;
                }
            });

            const finalScore = Math.min(12, Math.floor(score * 12 / 12));
            this.score += finalScore;
            
            feedbackMsg += finalScore >= 9 ? 
                `<br>💡 得分：${finalScore}/12 (优秀)` : 
                `<br>💡 得分：${finalScore}/12 (参考代码：<pre>${programAnswers.program3}</pre>)`;

            updateScore();
            feedback.innerHTML = feedbackMsg;
            feedback.classList.add('show');
        };

        // 初始化分数显示
        updateScore();
    </script>
</body>
</html>
