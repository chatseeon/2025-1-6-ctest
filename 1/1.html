<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C语言程序设计练习试卷1</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #2980b9;
            border-left: 4px solid #3498db;
            padding-left: 10px;
            margin-top: 30px;
        }
        .question {
            background-color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .options {
            margin: 10px 0;
        }
        .option {
            margin: 5px 0;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        .option:hover {
            background-color: #f0f0f0;
        }
        .option.selected {
            background-color: #d4edff;
        }
        .option.correct {
            background-color: #d4edda;
            color: #155724;
        }
        .option.wrong {
            background-color: #f8d7da;
            color: #721c24;
        }
        .explanation {
            display: none;
            padding: 10px;
            margin-top: 10px;
            background-color: #e9ecef;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .explanation.show {
            display: block;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .score-display {
            text-align: center;
            font-size: 1.2em;
            margin: 20px 0;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 5px;
        }
        .code {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        .error-line {
            background-color: #fff3cd;
        }
        .blank-line {
            background-color: #d1ecf1;
        }
    </style>
</head>
<body>
    <h1>C语言程序设计练习试卷1</h1>
    
    <div class="score-display">
        得分: <span id="score">0</span> / <span id="total">100</span>
    </div>

    <h2>一、选择题（每题2分，共50分）</h2>
    
    <div id="questions-container">
        <!-- 选择题将在这里动态生成 -->
    </div>

    <h2>二、改错题（每题15分，共30分）</h2>
    
    <div class="question">
        <p>1. 在屏幕上输出以下图形（说明：字符之间没有空格）。</p>
        <img src="./0605.png" alt="输出图形示例" style="max-height: 200px; margin: 10px 0;">
        <pre class="code">
#include &lt;stdio.h&gt;
void main()
{
  int i,j;
  i=<span class="error-line">7</span>;       /*$ERROR$*/
  while(i>0) 
   {
     j=1;
     while(j&lt;7-i)
     {  
        printf(" ");  /*输出一个空格*/
        j++;
     }
     j=<span class="error-line">i</span>;            /*$ERROR$*/ 
     while(j&lt;=i)
     { 
        printf("!");   
        j++;
     }
     printf("<span class="error-line">/n</span>");  /*$ERROR$*/
     i--;  
   }
}</pre>
        <div class="options">
            <p>请指出错误并修改：</p>
            <p>1. 第一处错误：<input type="text" id="correction1" placeholder="请输入修正后的代码"></p>
            <p>2. 第二处错误：<input type="text" id="correction2" placeholder="请输入修正后的代码"></p>
            <p>3. 第三处错误：<input type="text" id="correction3" placeholder="请输入修正后的代码"></p>
        </div>
        <button onclick="checkCorrections()">提交改错题答案</button>
        <div id="correction-feedback" class="explanation"></div>
    </div>

    <div class="question">
        <p>2. 函数search的功能是求解一维数组中的最小元素的下标。主函数调用search函数，将已给的一维数组的最小值和最小值下标输出。</p>
        <pre class="code">
#include &lt;stdio.h&gt;
int search(int a[],int n) 
{
 int i,min;
 min=<span class="error-line">1</span>;  /*$ERROR$*/
 for(i=1;i&lt;n;i++)
 {
  if(a[i]&lt;a[min])
    min=i; 
 }
 return <span class="error-line">i</span>;  /*$ERROR$*/
}
void main()
{
  int a[10]={-13,1,-5,4,9,0,-8,7,-6,2};
  int min;
  min=search(<span class="error-line">a[10]</span>,10); /*$ERROR$*/
  printf("min=%d,address=%d\n",a[min],min);
}</pre>
        <div class="options">
            <p>请指出错误并修改：</p>
            <p>1. 第一处错误：<input type="text" id="correction4" placeholder="请输入修正后的代码"></p>
            <p>2. 第二处错误：<input type="text" id="correction5" placeholder="请输入修正后的代码"></p>
            <p>3. 第三处错误：<input type="text" id="correction6" placeholder="请输入修正后的代码"></p>
        </div>
        <button onclick="checkCorrections2()">提交改错题答案</button>
        <div id="correction-feedback2" class="explanation"></div>
    </div>

    <h2>三、程序填空题（每空5分，共15分）</h2>
    
    <div class="question">
        <p>从键盘输入一行字符串，统计其中大写字母个数。</p>
        <pre class="code">
#include &lt;stdio.h&gt;
void main()
{
    char str[81];
    int i,count;
    printf("Input a string:\n");
    <span class="blank-line">_________</span>;   /*$BLANK$*/
    count=0; 
    i=<span class="blank-line">_________</span>;  /*$BLANK$*/
    while(str[i]!='\0')
    {
        if (str[i]>='A'&&str[i]&lt;='Z')
            <span class="blank-line">_________</span>;  /*$BLANK$*/
        i++;  	
    }
    printf("%d\n",count);
}</pre>
        <div class="options">
            <p>请填写空白处：</p>
            <p>1. 第一处空白：<input type="text" id="blank1" placeholder="请输入填空内容"></p>
            <p>2. 第二处空白：<input type="text" id="blank2" placeholder="请输入填空内容"></p>
            <p>3. 第三处空白：<input type="text" id="blank3" placeholder="请输入填空内容"></p>
        </div>
        <button onclick="checkBlanks()">提交填空题答案</button>
        <div id="blank-feedback" class="explanation"></div>
    </div>

    <h2>四、综合应用题（共30分）</h2>
    
    <div class="question">
        <p>1. （8分）键盘输入梯形的上底长a、下底长b和高h，计算并输出梯形的面积s。计算公式如下：s = (a + b) * h / 2</p>
        <img src="./1-1.png" alt="梯形面积公式" style="max-height: 100px; margin: 10px 0;">
        <div class="options">
            <p>请编写完整程序：</p>
            <textarea id="program1" rows="10" style="width:100%; font-family: 'Courier New', Courier, monospace;" placeholder="请在此处编写程序代码"></textarea>
        </div>
        <button onclick="checkProgram1()">提交程序答案</button>
        <div id="program1-feedback" class="explanation"></div>
    </div>

    <div class="question">
        <p>2. （10分）根据下式求s的值：</p>
        <p>要求：(1)使用循环实现；(2)输出结果保留5位小数，形式为：s=12.34567</p>
        <img src="2-1.png" alt="题目配图" style="max-width:100%; height:auto; margin:10px 0;">
        <div class="options">
            <p>请编写完整程序：</p>
            <textarea id="program2" rows="10" style="width:100%; font-family: 'Courier New', Courier, monospace;" placeholder="请在此处编写程序代码"></textarea>
        </div>
        <button onclick="checkProgram2()">提交程序答案</button>
        <div id="program2-feedback" class="explanation"></div>
    </div>

    <div class="question">
        <p>3. （12分）2020年新冠肺炎疫情期间，某医院4月份每天治愈病人数存储在数组a中，计算并输出该院4月份累计治愈病人总数和每天治愈病人数的平均值（要求使用循环实现，平均值结果保留2位小数）。</p>
        <pre class="code">
int a[30]={11,15,17,20,31,12,45,56,65,81,68,83,69,62,90,
            89,85,83,83,70,79,81,62,76,79,66,85,89,89,72};</pre>
        <div class="options">
            <p>请编写完整程序：</p>
            <textarea id="program3" rows="10" style="width:100%; font-family: 'Courier New', Courier, monospace;" placeholder="请在此处编写程序代码"></textarea>
        </div>
        <button onclick="checkProgram3()">提交程序答案</button>
        <div id="program3-feedback" class="explanation"></div>
    </div>

    <script>
        // 试题数据
        const questions = [
            {
                question: "1. 下列关于C语言程序书写规则的说法中正确的是______。",
                options: [
                    "A. 不区分大小写字母",
                    "B. 一行只能写一条语句",
                    "C. 一条语句可分成几行书写",
                    "D. 每行必须有行号"
                ],
                correct: 2,
                explanation: "解析：C语言中，一条语句可以分成多行书写，只要在适当的位置断开即可。"
            },
            {
                question: "2. 下面关于变量x、y定义及初始化正确的语句是______。",
                options: [
                    "A. int x=y=10;",
                    "B. char x='\\n',char y='b';",
                    "C. float x=3;int y=2;",
                    "D. double x=0.5;y=4.5;"
                ],
                correct: 2,
                explanation: "解析：C选项中虽然x和y类型不同，但定义和初始化语法是正确的。A选项需要先定义y；B选项多写了char；D选项y未定义类型。"
            },
            {
                question: "3. 以下不能定义为用户标识符的是______。",
                options: [
                    "A. Scanf",
                    "B. x_y",
                    "C. int",
                    "D. x12"
                ],
                correct: 2,
                explanation: "解析：int是C语言的关键字，不能作为用户标识符使用。"
            },
            {
                question: "4. 设有整型变量x,y，下列选项中，与表达式x*y/5值相同的表达式是______。",
                options: [
                    "A. x/5*y",
                    "B. (x*y)/5",
                    "C. (x/5)*(y/5)",
                    "D. x*(y/5)"
                ],
                correct: 1,
                explanation: "解析：原表达式x*y/5的计算顺序是先乘后除，B选项通过括号明确了相同的计算顺序。"
            },
            {
                question: "5. 设有int a;int f=3;，则执行语句a=(f++)%3;后a的值是______。",
                options: [
                    "A. 0",
                    "B. 1",
                    "C. 2",
                    "D. 3"
                ],
                correct: 0,
                explanation: "解析：f++是先使用f的值再自增，所以3%3=0，然后f变为4。"
            },
            {
                question: "6. 已知int x=1,y=2,z;，执行语句z=(x+y,x-y);后，变量z的值是______。",
                options: [
                    "A. 1",
                    "B. 2",
                    "C. 3",
                    "D. -1"
                ],
                correct: 3,
                explanation: "解析：逗号表达式的值是最后一个表达式的值，所以z=x-y=1-2=-1。"
            },
            {
                question: "7. 设有float f1=2.6,f2=2.5;，则表达式(int)f1+f2的值为______。",
                options: [
                    "A. 5",
                    "B. 4.5",
                    "C. 4",
                    "D. 5.5"
                ],
                correct: 1,
                explanation: "解析：(int)f1将2.6转换为2，然后2+2.5=4.5。"
            },
            {
                question: "8. 表示关系\"1&lt;x≤3\"的C语言表达式是______。",
                 options: [
                    "A. 1&lt;x≤3",
                    "B. (x&gt;1)and(x&lt;=3)",
                    "C. (1&lt;x)&&(x&lt;=3)",
                    "D. (1&lt;x)||(x&lt;=3)"
    ],
    correct: 2,
    explanation: "解析：C语言中用&&表示逻辑与，需要两个条件都满足。"
},
            {
                question: "9. 设有以下语句：char c1,c2;scanf(\"%c%c\",&c1,&c2);，若要为变量c1和c2分别输入字符A和B，正确的输入形式应该是______。",
                options: [
                    "A. A和B之间用逗号分隔",
                    "B. A和B之间不能有任何分隔符",
                    "C. A和B之间可以用回车分隔",
                    "D. A和B之间用空格分隔"
                ],
                correct: 1,
                explanation: "解析：%c%c格式会连续读取两个字符，中间不能有任何分隔符（包括空格和回车）。"
            },
            {
                question: "10. 以下程序段的输出结果是______。<br>int a=88;<br>if (a>90) printf(\"%d\",a);<br>if (a>80) printf(\"%d\",a);<br>if (a>70) printf(\"%d\",a);",
                options: [
                    "A. 888888",
                    "B. 8888",
                    "C. 88",
                    "D. 8"
                ],
                correct: 1,
                explanation: "解析：a=88不满足a>90，满足a>80和a>70，所以会输出两次88，共4个字符。"
            },
            {
                question: "11. 设有说明语句int a=1;，则执行以下语句后输出______。<br>switch(a){<br>case 1: printf(\"安徽\");<br>case 2: printf(\"计算机\");<br>default:printf(\"水平考试\");<br>}",
                options: [
                    "A. 安徽计算机水平考试",
                    "B. 安徽",
                    "C. 安徽计算机",
                    "D. 计算机水平考试"
                ],
                correct: 0,
                explanation: "解析：由于没有break语句，会从匹配的case 1开始一直执行到最后。"
            },
            {
                question: "12. for(表达式1;;表达式3)可理解为______。",
                options: [
                    "A. for(表达式1;0;表达式3)",
                    "B. for(表达式1;1;表达式3)",
                    "C. for(表达式1;表达式1;表达式3)",
                    "D. for(表达式1;表达式3;表达式3)"
                ],
                correct: 1,
                explanation: "解析：for循环中省略条件表达式时，默认为真(1)，形成无限循环。"
            },
            {
                question: "13. 执行下列语句后，变量b的值是______。<br>int a=1,b=9;<br>do{<br>b=b-a;<br>a++;<br>}while(b>0);",
                options: [
                    "A. -2",
                    "B. -1",
                    "C. 0",
                    "D. 1"
                ],
                correct: 1,
                explanation: "解析：循环过程：b=9-1=8,a=2; b=8-2=6,a=3; b=6-3=3,a=4; b=3-4=-1,a=5; 此时b=-1不满足b>0，循环结束。"
            },
            {
                question: "14. 执行以下程序段后，输出的结果是______。<br>int x=1;<br>while(1){<br>if(x==6) break;<br>x++;<br>}<br>printf(\"%d\\n\",x);",
                options: [
                    "A. 5",
                    "B. 6",
                    "C. 1",
                    "D. 7"
                ],
                correct: 1,
                explanation: "解析：x从1开始每次加1，当x=6时break退出循环，所以输出6。"
            },
            {
                question: "15. 以下选项中关于数组定义和初始化，正确的是______。",
                options: [
                    "A. int a[5]={1,2,3,4,5};",
                    "B. int a[5]=(1,2,3,4,5);",
                    "C. int a[5]=0;",
                    "D. int a[3]={1,2,3,4,5};"
                ],
                correct: 0,
                explanation: "解析：A选项是正确的数组初始化方式。B选项用了圆括号；C选项只能初始化第一个元素为0；D选项初始值过多。"
            },
            {
                question: "16. 已知int a[3][2]={1,2,3,4,5,6};，则a[1][1]的值是______。",
                options: [
                    "A. 4",
                    "B. 5",
                    "C. 3",
                    "D. 2"
                ],
                correct: 0,
                explanation: "解析：二维数组按行存储，a[1][1]是第二行第二列的元素，值为4。"
            },
            {
                question: "17. 下列数组定义及初始化合法的是______。",
                options: [
                    "A. char a[8][] = \"language\";",
                    "B. int a[5] = {0,1,2,3,4,5};",
                    "C. char a[] = \"string\";",
                    "D. int a[2][] = {0,1,2,3,4,5,6};"
                ],
                correct: 2,
                explanation: "解析：C选项是合法的字符数组初始化。A选项二维数组缺少列数；B选项初始值过多；D选项二维数组缺少列数。"
            },
            {
                question: "18. 下列函数值的类型是______。<br>fun(float x){<br>int y;<br>y=3*x-1;<br>return y;<br>}",
                options: [
                    "A. int",
                    "B. float",
                    "C. void",
                    "D. double"
                ],
                correct: 0,
                explanation: "解析：C语言中未指定返回类型的函数默认返回int类型。"
            },
            {
                question: "19. C语言函数中的全局变量是指______。",
                options: [
                    "A. 主函数的变量",
                    "B. 在所有函数之外定义的变量",
                    "C. 在局部变量有效的范围内起作用的变量",
                    "D. 默认初值不能为0或为NULL的变量"
                ],
                correct: 1,
                explanation: "解析：全局变量是在所有函数之外定义的变量，其作用域从定义处开始到文件结束。"
            },
            {
                question: "20. 若有函数：void fun(double a[], int *n){...}，则以下叙述中正确的是______。",
                options: [
                    "A. 调用fun函数时，数组a执行按值传送",
                    "B. 形参a和n都可以接收地址",
                    "C. 形参a和n都是普通常量",
                    "D. 调用fun函数时，形参n执行按值传送"
                ],
                correct: 1,
                explanation: "解析：数组名作为参数传递的是地址，指针n也是接收地址。"
            },
            {
                question: "21. 类型相同的两个指针变量之间不能进行的运算是_______。",
                options: [
                    "A. +",
                    "B. -",
                    "C. =",
                    "D. =="
                ],
                correct: 0,
                explanation: "解析：指针之间可以进行减法、赋值和比较运算，但不能进行加法运算。"
            },
            {
                question: "22. 若有以下程序：<br>#include \"stdio.h\"<br>void sub(int x,int *z){*z=x+1;}<br>void main(){<br>int a;<br>sub(10,&a);<br>printf(\"%d\",a);<br>}",
                options: [
                    "A. 0",
                    "B. 1",
                    "C. 10",
                    "D. 11"
                ],
                correct: 3,
                explanation: "解析：sub函数将x+1的值(11)通过指针z赋给a，所以输出11。"
            },
            {
                question: "23. 下列程序的输出结果是______。<br>#include &lt;stdio.h&gt;<br>#define SQR(x) x*x<br>void main(){<br>int k=2;<br>printf(\"%d\",SQR(k+1));<br>}",
                options: [
                    "A. 9",
                    "B. 6",
                    "C. 5",
                    "D. 4"
                ],
                correct: 2,
                explanation: "解析：宏展开为k+1*k+1=2+1*2+1=5，应该用括号将参数括起来：#define SQR(x) (x)*(x)。"
            },
            {
                question: "24. 下面不能正确定义结构体变量a的语句是______。",
                options: [
                    "A. struct xyz{char x;int y;float z;}; struct xyz a;",
                    "B. struct xyz{char x;int y;float z;} a;",
                    "C. struct xyz{char x;int y;float z;}; struct a;",
                    "D. struct {char x;int y;float z;} a;"
                ],
                correct: 2,
                explanation: "解析：C选项语法错误，struct a;缺少结构体类型名。"
            },
            {
                question: "25. 以读写方式打开一个已存在的文本文件file1.txt，以下选项中正确的是______。",
                options: [
                    "A. FILE *fp;fp=fopen(\"file1.txt\",\"r+\");",
                    "B. FILE *fp;fp=fopen(\"file1.txt\",\"w\");",
                    "C. FILE *fp;fp=fopen(\"file1.txt\",\"r\");",
                    "D. FILE *fp;fp=fopen(\"file1.txt\",\"a\");"
                ],
                correct: 0,
                explanation: "解析：\"r+\"模式可以读写已存在的文件。\"w\"会清空文件；\"r\"只能读；\"a\"只能追加。"
            }
        ];

        // 改错题和填空题的正确答案
        const correctionAnswers = {
            correction1: "1",
            correction2: "1",
            correction3: "'\\n'",
            correction4: "0",
            correction5: "min",
            correction6: "a",
            blank1: "gets(str)",
            blank2: "0",
            blank3: "count++"
        };

        // 综合应用题参考答案
        const programAnswers = {
            program1: `#include &lt;stdio.h&gt;
        void main()
        {
            float a, b, h, s;
            printf("请输入梯形的上底、下底和高：");
            scanf("%f%f%f", &a, &b, &h);
            s = (a + b) * h / 2;
            printf("梯形面积为：%.2f\\n", s);
        }`,
            program2: `#include &lt;stdio.h&gt;
        void main()
        {
            int i;
            double s = 0;
            for(i = 1; i <= 100; i++)
            {
                s += 1.0 / i;
            }
            printf("s=%.5f\\n", s);
        }`,
            program3: `#include &lt;stdio.h&gt;
        void main()
        {
            int a[30]={11,15,17,20,31,12,45,56,65,81,68,83,69,62,90,
                        89,85,83,83,70,79,81,62,76,79,66,85,89,89,72};
            int i, sum = 0;
            float avg;
            
            for(i = 0; i < 30; i++)
            {
                sum += a[i];
            }
            avg = sum / 30.0;
            
            printf("累计治愈病人总数：%d\\n", sum);
            printf("每天治愈病人平均数：%.2f\\n", avg);
        }`
        };

        // 初始化试卷
        let score = 0;
        let answeredQuestions = 0;
        const totalScore = 100;
        const questionsContainer = document.getElementById('questions-container');

        // 渲染选择题
        questions.forEach((q, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            questionDiv.innerHTML = `
                <p>${q.question}</p>
                <div class="options">
                    ${q.options.map((opt, i) => `
                        <div class="option" onclick="selectOption(this, ${index}, ${i})">${opt}</div>
                    `).join('')}
                </div>
                <div id="explanation-${index}" class="explanation">${q.explanation}</div>
            `;
            questionsContainer.appendChild(questionDiv);
        });

        // 更新分数显示
        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('total').textContent = totalScore;
        }

        // 选择选项
        window.selectOption = function(element, questionIndex, optionIndex) {
            const question = questions[questionIndex];
            const options = element.parentElement.children;
            
            // 移除之前的选择
            for (let i = 0; i < options.length; i++) {
                options[i].classList.remove('selected', 'correct', 'wrong');
            }
            
            // 标记当前选择
            element.classList.add('selected');
            
            // 检查答案
            if (optionIndex === question.correct) {
                element.classList.add('correct');
                // 只有第一次答对才加分
                if (!question.answered) {
                    score += 2;
                    question.answered = true;
                    answeredQuestions++;
                    updateScore();
                }
            } else {
                element.classList.add('wrong');
                // 标记正确答案
                options[question.correct].classList.add('correct');
            }
            
            // 显示解析
            document.getElementById(`explanation-${questionIndex}`).classList.add('show');
        };

        // 检查改错题答案
        window.checkCorrections = function() {
            // 标准化函数：处理全角/半角符号、多余空格等
            const normalizeCode = (code) => {
                return code
                    .replace(/；/g, ';')  // 中文分号 → 英文分号
                    .replace(/\s+/g, '')  // 移除所有空格
                    .toLowerCase();
            };

            // 正确答案配置（支持多种形式）
            const answers = {
                1: ["i=6", "i=6;"], 
                2: ["j=1", "j=1;"],
                3: ["printf(\"\\n\")", "printf(\"\\n\");", "printf('\\n');"]
            };

            let score = 0;
            const feedback = document.getElementById('correction-feedback');
            let feedbackHtml = "";

            // 检查每个空
            for (let i = 1; i <= 3; i++) {
                const userAnswer = normalizeCode(document.getElementById(`correction${i}`).value);
                const isCorrect = answers[i].some(correct => normalizeCode(correct) === userAnswer);

                if (isCorrect) {
                    score += 5;
                    feedbackHtml += `<p>✅ 第 ${i} 处正确 (+5分)</p>`;
                } else {
                    feedbackHtml += `<p>❌ 第 ${i} 处错误：应为 <code>${answers[i][0]}</code></p>`;
                }
            }

            // 更新分数和反馈
            this.score += score;
            updateScore();
            feedback.innerHTML = `${feedbackHtml}<p>总计得分：${score}/15 分</p>`;
            feedback.classList.add('show');
        };

        // 检查第二道改错题答案
        window.checkCorrections2 = function() {
            // 标准化函数：处理全角/半角符号、多余空格等
            const normalizeCode = (code) => {
                return code
                    .replace(/；/g, ';')  // 中文分号 → 英文分号
                    .replace(/\s+/g, '')  // 移除所有空格
                    .toLowerCase();
            };

        // 正确答案配置（支持多种形式）
        const answers = {
            4: ["min=0", "min=0;"], 
            5: ["return min", "return min;"],
            6: ["min=search(a,10)", "min=search(a,10);"]
        };

        let score = 0;
        const feedback = document.getElementById('correction-feedback2');
        let feedbackHtml = "";

        // 检查每个空
        for (let i = 4; i <= 6; i++) {
            const userAnswer = normalizeCode(document.getElementById(`correction${i}`).value);
            const isCorrect = answers[i].some(correct => normalizeCode(correct) === userAnswer);

            if (isCorrect) {
                score += 5;
                feedbackHtml += `<p>✅ 第 ${i-3} 处正确 (+5分)</p>`;
            } else {
                feedbackHtml += `<p>❌ 第 ${i-3} 处错误：应为 <code>${answers[i][0]}</code></p>`;
            }
        }

        // 更新分数和反馈
        this.score += score;
        updateScore();
        feedback.innerHTML = `${feedbackHtml}<p>总计得分：${score}/15 分</p>`;
        feedback.classList.add('show');
    };

        // 检查填空题答案
        window.checkBlanks = function() {
            // 标准化函数：处理全角/半角符号、多余空格等
            const normalizeCode = (code) => {
                return code
                    .replace(/；/g, ';')  // 中文分号 → 英文分号
                    .replace(/\s+/g, '')  // 移除所有空格
                    .toLowerCase();
            };

            // 正确答案配置（支持多种形式）
            const answers = {
                1: ["gets(str)", "gets(str);"], 
                2: ["0", "0;"],
                3: ["count++", "count++;"]
            };

            let score = 0;
            const feedback = document.getElementById('blank-feedback');
            let feedbackHtml = "";

            // 检查每个空
            for (let i = 1; i <= 3; i++) {
                const userAnswer = normalizeCode(document.getElementById(`blank${i}`).value);
                const isCorrect = answers[i].some(correct => normalizeCode(correct) === userAnswer);

                if (isCorrect) {
                    score += 5;
                    feedbackHtml += `<p>✅ 第 ${i} 处正确 (+5分)</p>`;
                } else {
                    feedbackHtml += `<p>❌ 第 ${i} 处错误：应为 <code>${answers[i][0]}</code></p>`;
                }
            }

            // 更新分数和反馈
            this.score += score;
            updateScore();
            feedback.innerHTML = `${feedbackHtml}<p>总计得分：${score}/15 分</p>`;
            feedback.classList.add('show');
        };

       // 应用题增强版代码验证方法
       window.checkProgram1 = function() {
            const userCode = document.getElementById('program1').value.trim();
            const feedback = document.getElementById('program1-feedback');
            
            let score = 0;
            const checks = [
                { 
                    pattern: /#include\s*<stdio\.h>/i, 
                    weight: 1,
                    message: "✅ 包含标准输入输出头文件"
                },
                { 
                    // 接受float或double类型
                    pattern: /(float|double)\s+[abh]/i, 
                    weight: 1,
                    message: "✅ 正确定义了变量"
                },
                {
                    pattern: /scanf\s*\(.*%f.*[abh]/i,  // 放宽输入检查
                    weight: 2,
                    message: "✅ 正确获取输入数据"
                },
                {
                    pattern: /s\s*=\s*.*(a\s*\+\s*b).*\*.*h.*\/.*2|梯形面积/i,  // 放宽公式检查
                    weight: 3,
                    message: "✅ 包含正确的面积计算公式"
                },
                { 
                    // 接受各种常见输出格式
                    pattern: /printf\s*\(.*(s\s*=.*|梯形面积.*)(%\.?\d*f|%\.?\d*lf)/i, 
                    weight: 1,
                    message: "✅ 正确输出结果"
                }
            ];

            let feedbackMsg = "<strong>检查结果：</strong><br>";
            checks.forEach(check => {
                if (check.pattern.test(userCode)) {
                    score += check.weight;
                    feedbackMsg += check.message + `<br>`;
                } else {
                    feedbackMsg += `❌ 缺少：${check.message.replace("✅ ", "")}<br>`;
                }
            });

            const finalScore = Math.min(8, Math.floor(score * 8 / 8));
            this.score += finalScore;
            
            feedbackMsg += finalScore >= 6 ? 
                `<br>💡 得分：${finalScore}/8 (良好)` : 
                `<br>💡 得分：${finalScore}/8 (参考代码：<pre>${programAnswers.program1}</pre>)`;

            updateScore();
            feedback.innerHTML = feedbackMsg;
            feedback.classList.add('show');
        };

        window.checkProgram2 = function() {
            const userCode = document.getElementById('program2').value.trim();
            const feedback = document.getElementById('program2-feedback');
            
            let score = 0;
            const checks = [
                {
                    pattern: /for\s*\(.*[int]?\s*i\s*=.*1.*;.*i\s*<=.*100/i,
                    weight: 3,
                    message: "✅ 正确实现1-100循环"
                },
                {
                    pattern: /s\s*\+=\s*1\.0\s*\/\s*i|s\s*=\s*s\s*\+\s*1\.0\s*\/\s*i/i,
                    weight: 4,
                    message: "✅ 包含正确的累加逻辑"
                },
                {
                    pattern: /printf\s*\(.*%\.5f/i,
                    weight: 3,
                    message: "✅ 正确格式化输出(5位小数)"
                }
            ];

            let feedbackMsg = "<strong>检查结果：</strong><br>";
            checks.forEach(check => {
                if (check.pattern.test(userCode)) {
                    score += check.weight;
                    feedbackMsg += check.message + `<br>`;
                } else {
                    feedbackMsg += `❌ 缺少：${check.message.replace("✅ ", "")}<br>`;
                }
            });

            const finalScore = Math.min(10, Math.floor(score * 10 / 10));
            this.score += finalScore;
            
            feedbackMsg += finalScore >= 7 ? 
                `<br>💡 得分：${finalScore}/10 (良好)` : 
                `<br>💡 得分：${finalScore}/10 (参考代码：<pre>${programAnswers.program2}</pre>)`;

            updateScore();
            feedback.innerHTML = feedbackMsg;
            feedback.classList.add('show');
        };

        window.checkProgram3 = function() {
            const userCode = document.getElementById('program3').value.trim();
            const feedback = document.getElementById('program3-feedback');
            
            let score = 0;
            const checks = [
                {
                    pattern: /for\s*\(.*i\s*=.*0.*;.*i\s*<.*30/i,
                    weight: 3,
                    message: "✅ 正确遍历30天数据"
                },
                {
                    pattern: /sum\s*\+=\s*a\[i\]|sum\s*=\s*sum\s*\+\s*a\[i\]/i,
                    weight: 4,
                    message: "✅ 正确计算累计值"
                },
                {
                    pattern: /(avg|aver)\s*=\s*sum\s*\/\s*(30\.0|30\.[0f])|sum\s*\/\s*30\.[0f]/i,  // 接受avg或aver
                    weight: 3,
                    message: "✅ 正确计算平均值"
                },
                {
                    pattern: /printf\s*\(.*%\.2[lf]/i,  // 同时接受%f和%lf
                    weight: 2,
                    message: "✅ 正确格式化输出(2位小数)"
                }
            ];

            let feedbackMsg = "<strong>检查结果：</strong><br>";
            checks.forEach(check => {
                if (check.pattern.test(userCode)) {
                    score += check.weight;
                    feedbackMsg += check.message + `<br>`;
                } else {
                    feedbackMsg += `❌ 缺少：${check.message.replace("✅ ", "")}<br>`;
                }
            });

            const finalScore = Math.min(12, Math.floor(score * 12 / 12));
            this.score += finalScore;
            
            feedbackMsg += finalScore >= 9 ? 
                `<br>💡 得分：${finalScore}/12 (优秀)` : 
                `<br>💡 得分：${finalScore}/12 (参考代码：<pre>${programAnswers.program3}</pre>)`;

            updateScore();
            feedback.innerHTML = feedbackMsg;
            feedback.classList.add('show');
        };

        // 初始化分数显示
        updateScore();
    </script>
</body>
</html>
